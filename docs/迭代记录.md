# 迭代记录

## 版本总览

| 版本 | 阶段 | 概括 |
|------|------|------|
| V1-V3 | 原型验证 | 技术栈跑通 |
| V4-V12 | 功能完善 | 路书规范、高级设置 |
| V13-V22 | 稳定性优化 | API切换、流式输出 |
| V23-V28 | 简化迭代 | 去掉冗余步骤 |
| V29-V33 | 运维增强 | 日志、错误提示、自检 |
| V34-V47 | 批量处理 | 批量生成、Markdown解析器 |
| V48 | 批量处理增强 | MD文件、文件命名、文件上传、AI文件处理、写作素材模板 |

## V48 详情（完整版）

### V48 - 批量处理功能增强（12个Step）

**M1 里程碑：MD文件生成**
- Step 1：新增「生成MD文件」选项
- Step 2：模板类型改为4选1（教学材料/通用文档/MD文件/词汇卡片）

**M2 里程碑：Markdown解析器完善**
- Step 3：修复粗体/斜体解析
- Step 4：新增表格支持
- Step 5：新增列表/引用/分隔线支持

**M3 里程碑：文件命名方式B**
- Step 6：支持从文本解析文件名（一行一个，空行用默认值）

**M4 里程碑：批量文件上传**
- Step 7：后端接口 POST /api/batch/upload-files
  - 支持文档：.docx, .md, .txt, .pdf（存S3返回URL）
  - 支持图片：.png, .jpg, .jpeg, .webp（转Base64）
- Step 8：前端界面
  - 文件上传区域
  - 上传预览（显示每个任务对应的文件）

**M5 里程碑：AI文件处理**
- Step 9：将上传的文件/图片传给AI
  - 图片使用 image_url 类型（Base64）
  - 文档使用 file_url 类型（URL）
  - 修改 llm.ts 支持更多 MIME 类型

**M6 里程碑：写作素材模板**
- Step 10：前端新增「写作素材模板」选项（值：writing_material）
- Step 11：创建 writingMaterialGenerator.ts 模块
  - 紫色主题（6A1B9A）
  - Part/List 标题横幅（带书签）
  - 分类/小节标题（紫色加粗）
  - 条目列表（紫色编号+黑色英文+灰色中文）
- Step 12：集成到批量任务流程
  - 识别 writing_material 模板类型
  - 解析 JSON 并调用模板生成 Word

### 模板类型完整列表（5种）

| 选项值 | 显示文字 | 描述 |
|--------|----------|------|
| markdown_styled | 教学材料（带样式） | 紫色标题、表格高亮 |
| markdown_plain | 通用文档（无样式） | 黑白简洁 |
| markdown_file | 生成MD文件（不转换） | 直接保存.md文件 |
| word_card | 词汇卡片（精确排版） | JSON → 词汇卡片模板 |
| writing_material | 写作素材模板 | JSON → 写作素材模板 |

## V34-V47 详情

### V47 - Markdown解析器完善（M2里程碑）
- 新增列表支持（有序/无序）
- 新增引用块支持
- 新增分隔线支持

### V46 - Markdown解析器增强
- 新增表格支持
- 修复粗体/斜体解析

### V45 - 模板类型4选1
- 教学材料（带样式）
- 通用文档（无样式）
- 生成MD文件（不转换）
- 词汇卡片（精确排版）

## V29-V33 详情

### V29 - 日志与调试系统
- 中文错误提示系统
- 日志记录和导出功能

### V30 - 日志导出优化
- 显示路径和链接

### V31 - 日志导出修复
- 修复上传状态检查

### V32 - 上传错误处理
- 5个文档都添加上传状态检查

### V33 - 一键自检功能
- 检测8项基础条件
- 显示当前配置值

---
*文档更新：2026年1月15日 | V48 完成（12个Step）*
