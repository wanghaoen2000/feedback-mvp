# 学情反馈MVP - TODO

## 核心功能
- [x] 前端：简单输入表单（算术题输入框）
- [x] 后端：tRPC接口调用Claude API计算
- [x] 后端：Google Drive文件上传功能
- [x] 集成：将计算结果保存到指定路径

## 测试
- [x] 端到端测试：输入算术题 → 计算 → 保存到Google Drive

## 完整版功能（V2）
- [x] 前端：三个长文本输入框（上次反馈/本次笔记/录音转文字）
- [x] 前端：学生姓名、课次、日期输入
- [x] 前端：特殊要求输入框（可选）
- [x] 前端：新生首次课模式切换
- [x] 后端：调用LLM生成学情反馈文档
- [x] 后端：调用LLM生成复习文档
- [x] 后端：调用LLM生成测试本
- [x] 后端：调用LLM生成课后信息提取
- [x] 后端：生成气泡图PNG
- [x] 后端：按新路径存储到Google Drive（Mac/Documents/XDF/学生档案/学生名/子文件夹/）
- [x] 测试：完整流程端到端测试

## 状态显示和结果反馈（V3）
- [x] 前端：实时进度条显示当前步骤
- [x] 前端：每步状态图标（成功✓/失败✗/进行中...）
- [x] 前端：失败时显示具体错误信息
- [x] 后端：返回分步执行状态
- [x] 后端：Google Drive文件验证（检查文件是否真的存在）
- [x] 前端：显示最终文件列表和Google Drive链接


## 格式规范修复（V4）
- [x] 将V9路书的学情反馈格式要求写入系统提示词
- [x] 将V9路书的复习文档格式要求写入系统提示词
- [x] 将V9路书的测试本格式要求写入系统提示词
- [x] 将V9路书的课后信息提取格式要求写入系统提示词
- [x] 将V9路书的气泡图格式要求写入系统提示词
- [x] 测试验证生成的文档格式是否符合路书规范

## Bug修复和API切换（V5）
- [x] 修复Word文档格式问题（使用docx库正确生成docx）
- [x] 修复气泡图生成问题（使用sharp库将SVG转换为PNG）
- [x] 切换到神马中转API（https://api.whatai.cc/v1）
- [x] 配置默认使用claude-opus-4-5-20251101-thinking模型
- [x] 测试验证所有修复

## Bug修复（V6）
- [x] 诊断并修复API fetch failed错误（添加超时设置和重试机制）

## 模型切换（V7）
- [x] 将默认模型从Opus切换到claude-sonnet-4-5-20250929

## 超时延长（V8）
- [x] 延长API请求超时时间（复杂任务10分钟，简单任务3分钟）

## Bug修复（V9）
- [~] 修复前端进度显示问题（跳过，后续优化）
- [x] 修复学情反馈格式（纯文本，无markdown标记）
- [x] 修复Word文档格式（正确分页符，无markdown/HTML标记）
- [x] 修复课上生词数量问题（强调15-25个硬性要求）

## 多轮API重构（V10）
- [x] 重构后端API：拆分为5个独立端点（学情反馈、复习文档、测试本、课后信息、气泡图）
- [x] 重构前端：实现自动多轮调用，每完成一个自动触发下一个
- [x] 添加实时进度显示：显示当前正在生成哪个文档

## V11 界面优化
- [x] 删除日期字段（本次课日期、下次课日期），AI自动从笔记提取
- [x] 添加高级设置区域（默认折叠）
- [x] 添加模型名称配置（可持久化）
- [x] 添加API密钥配置（可持久化）
- [x] 添加API地址配置（可持久化）
- [x] 修改AI提示词，自动从笔记中提取日期信息

## V12 单步重试功能
- [x] 在失败的步骤旁边添加“重试”按钮
- [x] 实现单步重试逻辑（只重新执行失败的那一步）
- [x] 重试成功后自动继续后续步骤
